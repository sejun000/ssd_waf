import pandas as pd
import matplotlib.pyplot as plt
import matplotlib.ticker as mticker
import io

# 1. C++ 프로그램의 CSV 출력을 여기에 붙여넣으세요.
# (위 C++ 예제 코드의 실행 결과 예시)
csv_output = """CacheSize,MissRate
1875666,60.4627
3751332,51.3423
5626998,47.4946
7502664,45.9408
9378330,45.0748
11253996,44.5736
13129662,44.1889
15005328,43.8109
16880994,43.5479
18756660,43.2838
20632326,43.1200
22507992,43.0169
24383658,42.9319
26259324,42.8248
28134990,42.5930
30010656,42.5152
31886322,42.4294
33761988,42.3547
35637654,42.2997
37513320,42.2466
39388986,42.1813
41264652,42.1311
43140318,42.0880
45015984,42.0494
46891650,42.0036
48767316,41.9686
50642982,41.9268
52518648,41.8830
54394314,41.8052
56269980,41.7388
58145646,41.6606
60021312,41.5283
61896978,41.4541
63772644,41.3013
65648310,41.0238
67523976,40.7559
69399642,40.4136
71275308,40.1268
73150974,39.7765
75026640,39.3621
76902306,38.5559
78777972,37.8848
80653638,37.2686
82529304,36.8237
84404970,36.2947
86280636,35.7925
88156302,35.1538
90031968,34.5627
91907634,33.9446
93783300,33.4520
95658966,32.9897
97534632,32.2376
99410298,31.5400
101285964,30.8900
103161630,30.4096
105037296,30.0661
106912962,29.8222
108788628,29.5931
110664294,29.4153
112539960,29.1861
114415626,28.9843
116291292,28.8297
118166958,28.6792
120042624,28.5637
121918290,28.4668
123793956,28.3733
125669622,28.2063
127545288,28.0446
129420954,27.8385
131296620,27.5616
133172286,27.2704
135047952,26.7669
136923618,26.3683
138799284,26.0122
140674950,25.7893
142550616,25.6062
144426282,25.4447
146301948,25.2557
148177614,25.0175
150053280,24.8312
151928946,24.6857
153804612,24.5980
155680278,24.5014
157555944,24.3688
159431610,24.2300
161307276,24.1105
163182942,24.0458
165058608,23.9542
166934274,23.8835
168809940,23.7082
170685606,23.5189
172561272,23.3952
174436938,23.2940
176312604,23.2222
178188270,23.1612
180063936,23.0640
181939602,22.9808
183815268,22.9309
185690934,22.9016
187566600,22.8790
189442266,22.8655
191317932,22.8538
193193598,22.8460
195069264,22.8402
196944930,22.8354
198820596,22.8308
200696262,22.8268
202571928,22.8232
204447594,22.8177
206323260,22.8111
208198926,22.8053
210074592,22.7988
211950258,22.7920
213825924,22.7815
215701590,22.7766
217577256,22.7739
219452922,22.7726
221328588,22.7722
223204254,22.7722
225079920,22.7722
226955586,22.7722
228831252,22.7722
230706918,22.7722
232582584,22.7722
234458250,22.7722
236333916,22.7722
238209582,22.7722
240085248,22.7722
241960914,22.7722
243836580,22.7722
245712246,22.7722
247587912,22.7722
249463578,22.7722
251339244,22.7722
253214910,22.7722
255090576,22.7722
256966242,22.7722
258841908,22.7722
260717574,22.7722
262593240,22.7722
264468906,22.7722
266344572,22.7722
268220238,22.7722
270095904,22.7722
271971570,22.7722
273847236,22.7722
275722902,22.7722
277598568,22.7722
279474234,22.7722
281349900,22.7722
283225566,22.7722
285101232,22.7722
286976898,22.7722
288852564,22.7722
290728230,22.7722
292603896,22.7722
294479562,22.7722
296355228,22.7722
298230894,22.7722
300106560,22.7722
301982226,22.7722
303857892,22.7722
305733558,22.7722
307609224,22.7722
309484890,22.7722
311360556,22.7722
313236222,22.7722
315111888,22.7722
316987554,22.7722
318863220,22.7722
320738886,22.7722
322614552,22.7722
324490218,22.7722
326365884,22.7722
328241550,22.7722
330117216,22.7722
331992882,22.7722
333868548,22.7722
335744214,22.7722
337619880,22.7722
339495546,22.7722
341371212,22.7722
343246878,22.7722
345122544,22.7722
346998210,22.7722
348873876,22.7722
350749542,22.7722
352625208,22.7722
354500874,22.7722
356376540,22.7722
358252206,22.7722
360127872,22.7722
362003538,22.7722
363879204,22.7722
365754870,22.7722
367630536,22.7722
369506202,22.7722
371381868,22.7722
373257534,22.7722
375133200,22.7722
377008866,22.7722
378884532,22.7722
380760198,22.7722
382635864,22.7722
384511530,22.7722
386387196,22.7722
388262862,22.7722
390138528,22.7722
392014194,22.7722
393889860,22.7722
395765526,22.7722
397641192,22.7722
399516858,22.7722
401392524,22.7722
403268190,22.7722
405143856,22.7722
407019522,22.7722
408895188,22.7722
410770854,22.7722
412646520,22.7722
414522186,22.7722
416397852,22.7722
418273518,22.7722
420149184,22.7722
422024850,22.7722
423900516,22.7722
425776182,22.7722
427651848,22.7722
429527514,22.7722
431403180,22.7722
433278846,22.7722
435154512,22.7722
437030178,22.7722
438905844,22.7722
440781510,22.7722
442657176,22.7722
444532842,22.7722
446408508,22.7722
448284174,22.7722
450159840,22.7722
452035506,22.7722
453911172,22.7722
455786838,22.7722
457662504,22.7722
459538170,22.7722
461413836,22.7722
463289502,22.7722
465165168,22.7722
467040834,22.7722
468916500,22.7722
470792166,22.7722
472667832,22.7722
474543498,22.7722
476419164,22.7722
478294830,22.7722
480170496,22.7722
482046162,22.7722
483921828,22.7722
485797494,22.7722
487673160,22.7722
489548826,22.7722
491424492,22.7722
493300158,22.7722
495175824,22.7722
497051490,22.7722
498927156,22.7722
500802822,22.7722
502678488,22.7722
504554154,22.7722
506429820,22.7722
508305486,22.7722
510181152,22.7722
512056818,22.7722
513932484,22.7722
515808150,22.7722
517683816,22.7722
519559482,22.7722
521435148,22.7722
523310814,22.7722
525186480,22.7722
527062146,22.7722
528937812,22.7722
530813478,22.7722
532689144,22.7722
534564810,22.7722
536440476,22.7722
538316142,22.7722
540191808,22.7722
542067474,22.7722
543943140,22.7722
545818806,22.7722
547694472,22.7722
549570138,22.7722
551445804,22.7722
553321470,22.7722
555197136,22.7722
557072802,22.7722
558948468,22.7722
560824134,22.7722
562699800,22.7722
564575466,22.7722
566451132,22.7722
568326798,22.7722
570202464,22.7722
572078130,22.7722
573953796,22.7722
575829462,22.7722
577705128,22.7722
579580794,22.7722
581456460,22.7722
583332126,22.7722
585207792,22.7722
587083458,22.7722
588959124,22.7722
590834790,22.7722
592710456,22.7722
594586122,22.7722
596461788,22.7722
598337454,22.7722
600213120,22.7722
602088786,22.7722
603964452,22.7722
605840118,22.7722
607715784,22.7722
609591450,22.7722
611467116,22.7722
613342782,22.7722
615218448,22.7722
617094114,22.7722
618969780,22.7722
620845446,22.7722
622721112,22.7722
624596778,22.7722
626472444,22.7722
628348110,22.7722
630223776,22.7722
632099442,22.7722
633975108,22.7722
635850774,22.7722
637726440,22.7722
639602106,22.7722
641477772,22.7722
643353438,22.7722
645229104,22.7722
647104770,22.7722
648980436,22.7722
650856102,22.7722
652731768,22.7722
654607434,22.7722
656483100,22.7722
658358766,22.7722
660234432,22.7722
662110098,22.7722
663985764,22.7722
665861430,22.7722
667737096,22.7722
669612762,22.7722
671488428,22.7722
673364094,22.7722
675239760,22.7722
677115426,22.7722
678991092,22.7722
680866758,22.7722
682742424,22.7722
684618090,22.7722
686493756,22.7722
688369422,22.7722
690245088,22.7722
692120754,22.7722
693996420,22.7722
695872086,22.7722
697747752,22.7722
699623418,22.7722
701499084,22.7722
703374750,22.7722
705250416,22.7722
707126082,22.7722
709001748,22.7722
710877414,22.7722
712753080,22.7722
714628746,22.7722
716504412,22.7722
718380078,22.7722
720255744,22.7722
722131410,22.7722
724007076,22.7722
725882742,22.7722
727758408,22.7722
729634074,22.7722
731509740,22.7722
733385406,22.7722
735261072,22.7722
737136738,22.7722
739012404,22.7722
740888070,22.7722
742763736,22.7722
744639402,22.7722
746515068,22.7722
748390734,22.7722
750266400,22.7722
752142066,22.7722
754017732,22.7722
755893398,22.7722
757769064,22.7722
759644730,22.7722
761520396,22.7722
763396062,22.7722
765271728,22.7722
767147394,22.7722
769023060,22.7722
770898726,22.7722
772774392,22.7722
774650058,22.7722
776525724,22.7722
778401390,22.7722
780277056,22.7722
782152722,22.7722
784028388,22.7722
785904054,22.7722
787779720,22.7722
789655386,22.7722
791531052,22.7722
793406718,22.7722
795282384,22.7722
797158050,22.7722
799033716,22.7722
800909382,22.7722
802785048,22.7722
804660714,22.7722
806536380,22.7722
808412046,22.7722
810287712,22.7722
812163378,22.7722
814039044,22.7722
815914710,22.7722
817790376,22.7722
819666042,22.7722
821541708,22.7722
823417374,22.7722
825293040,22.7722
827168706,22.7722
829044372,22.7722
830920038,22.7722
832795704,22.7722
834671370,22.7722
836547036,22.7722
838422702,22.7722
840298368,22.7722
842174034,22.7722
844049700,22.7722
845925366,22.7722
847801032,22.7722
849676698,22.7722
851552364,22.7722
853428030,22.7722
855303696,22.7722
857179362,22.7722
859055028,22.7722
860930694,22.7722
862806360,22.7722
864682026,22.7722
866557692,22.7722
868433358,22.7722
870309024,22.7722
872184690,22.7722
874060356,22.7722
875936022,22.7722
877811688,22.7722
879687354,22.7722
881563020,22.7722
883438686,22.7722
885314352,22.7722
887190018,22.7722
889065684,22.7722
890941350,22.7722
892817016,22.7722
894692682,22.7722
896568348,22.7722
898444014,22.7722
900319680,22.7722
902195346,22.7722
904071012,22.7722
905946678,22.7722
907822344,22.7722
909698010,22.7722
911573676,22.7722
913449342,22.7722
915325008,22.7722
917200674,22.7722
919076340,22.7722
920952006,22.7722
922827672,22.7722
924703338,22.7722
926579004,22.7722
928454670,22.7722
930330336,22.7722
932206002,22.7722
934081668,22.7722
935957334,22.7722
937832689,22.7722
"""

# 2. C++ 코드에 입력했던 전체 데이터셋 크기를 동일하게 입력하세요.
total_dataset_size = 10 # 블록 단위

# 3. 데이터 파싱 및 가공
try:
    # 문자열 데이터를 파일처럼 읽어서 DataFrame으로 변환
    df = pd.read_csv(io.StringIO(csv_output))

    # 가로축 계산: 캐시 크기 / 전체 데이터셋 크기
    df['CacheSizeRatio'] = df['CacheSize'] / total_dataset_size
    
    # 세로축: Miss Rate (이미 비율로 계산되어 있음)
    df['MissRateRatio'] = df['MissRate']

    # 4. 그래프 생성
    plt.style.use('seaborn-v0_8-whitegrid')
    fig, ax = plt.subplots(figsize=(10, 6))

    ax.plot(df['CacheSizeRatio'], df['MissRateRatio'], marker='o', linestyle='-', markersize=6)

    # 5. 그래프 서식 설정
    ax.set_title('Cache Miss Curve by Dataset Size Ratio', fontsize=16)
    ax.set_xlabel('Cache Size Ratio (Cache Size / Total Dataset Size)', fontsize=12)
    ax.set_ylabel('Cache Miss Ratio', fontsize=12)

    # x축과 y축을 퍼센트(%) 형식으로 표시
    ax.xaxis.set_major_formatter(mticker.PercentFormatter(xmax=1.0))
    ax.yaxis.set_major_formatter(mticker.PercentFormatter(xmax=1.0))

    # 축 범위 설정 (0% ~ 100%)
    ax.set_xlim(0, 1.0)
    ax.set_ylim(0, 1.0)
    ax.grid(True, which='both', linestyle='--', linewidth=0.5)

    # 그래프 파일로 저장 및 출력
    plt.tight_layout()
    plt.savefig('mrc_graph.png', dpi=300)
    plt.show()
    
    print("그래프가 'mrc_graph.png' 파일로 성공적으로 저장되었습니다.")

except Exception as e:
    print(f"오류가 발생했습니다: {e}")
    print("입력된 CSV 데이터 형식을 확인해주세요. (예: CacheSize,MissRate)")